{% extends "base.html" %}
{% block content %}
<div class="row space">
  <div>
    <h1>{{ b['title'] }}</h1>
    <p class="muted">{{ b['category'] or '—' }} • {{ b['language']|upper }} • {{ b['status'] }}</p>
  </div>
  <div>
    <a class="btn ghost" href="{{ url_for('author.book_edit', book_id=b['id']) }}">Edit</a>
    <form style="display:inline" method="post" action="{{ url_for('author.book_generate', book_id=b['id']) }}">
      <button class="btn" type="submit">Generate Intelligence</button>
    </form>
    {% if b['status'] != 'published' %}
    <form style="display:inline" method="post" action="{{ url_for('author.book_publish', book_id=b['id']) }}">
      <button class="btn" type="submit">Publish</button>
    </form>
    {% endif %}
    {% if intel %}
    <a class="btn ghost" href="{{ url_for('author.book_launch_pack', book_id=b['id']) }}">Download Launch Pack</a>
    {% endif %}
  </div>
</div>

<div class="grid2">
  <div class="card">
    <h3>Public link</h3>
    {% if b['status']=='published' %}
    <p><a href="{{ url_for('public.public_book', book_id=b['id']) }}">/book/{{ b['id'] }}</a></p>
    <p class="muted">Widget embed:</p>
    <code>&lt;iframe src="{{ url_for('public.widget_book', book_id=b['id']) }}" style="width:100%;max-width:420px;height:240px;border:0"&gt;&lt;/iframe&gt;</code>
    {% else %}
    <p class="muted">Publish to get a public link and widget.</p>
    {% endif %}
    <p><a class="btn small ghost" href="{{ url_for('author.whatsapp_pitch') }}">WhatsApp Pitch Group</a></p>
  </div>

  <div class="card">
    <h3>Video presentation placeholder</h3>
    <div class="video-ph">
      {% if b['language']=='fr' %}
      Présentation vidéo (FR) — à remplacer par votre vidéo.
      {% else %}
      Video presentation (EN) — replace with your video.
      {% endif %}
    </div>
  </div>
</div>

{% if intel %}
<section class="section">
  <h2>Keywords & Hashtags</h2>
  <div class="card">
    <p><strong>Keywords:</strong> {{ (intel['keywords_json']|safe)|fromjson|join(', ') or 'None' }}</p>
    <p><strong>Hashtags:</strong> {{ (intel['hashtags_json']|safe)|fromjson|join(' ') or 'None' }}</p>
  </div>
</section>

<section class="section">
  <h2>Target Audiences</h2>
  <div class="grid">
    {% for a in (intel['audience_json']|safe)|fromjson %}
    <div class="card">
      <h3>{{ a['persona'] }}</h3>
      <p><strong>Need:</strong> {{ a['need'] }}</p>
      <p><strong>Objection:</strong> {{ a['objection'] }}</p>
      <p><strong>Hook:</strong> {{ a['hook'] }}</p>
    </div>
    {% endfor %}
  </div>
</section>

<section class="section">
  <h2>Best Channels</h2>
  <div class="card">{{ (intel['channels_json']|safe)|fromjson|join(' • ') }}</div>
</section>

<section class="section">
  <h2>Channel Messages & CTAs</h2>
  <div class="grid">
    {% for m in (intel['messages_json']|safe)|fromjson %}
    <div class="card">
      <h3>{{ m['channel'] }}</h3>
      <pre class="pre">{{ m['message'] }}</pre>
    </div>
    {% endfor %}
  </div>
</section>

<section class="section">
  <h2>Emotional Reach</h2>
  <div class="card">
    {% for e in (intel['emotional_json']|safe)|fromjson %}
    <span class="pill">{{ e['emotion'] }}: {{ e['score'] }}</span>
    {% endfor %}
  </div>
</section>

<section class="section">
  <h2>Gift Ideas (Lead Magnet)</h2>
  <div class="card">
    <ul>
      {% for gft in (intel['gift_json']|safe)|fromjson %}
      <li>{{ gft }}</li>
      {% endfor %}
    </ul>
  </div>
</section>
{% else %}
<div class="card">
  No intelligence yet. Click <strong>Generate Intelligence</strong>.
</div>
{% endif %}
{% endblock %}